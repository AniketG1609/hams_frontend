<div id="doctor-dashboard" class="flex min-h-screen bg-gray-100">
  <app-sidebar [doctor]="doctor"></app-sidebar>

  <main class="flex-1 p-8 overflow-y-auto">
    <app-doctor-header
      [doctor]="doctor"
      [notificationCount]="stats.notifications"
    ></app-doctor-header>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div
        class="bg-white p-6 rounded-xl shadow flex justify-between items-center hover:shadow-lg transition"
      >
        <div>
          <h3 class="text-gray-500 text-sm font-medium mb-1">Today's Appointments</h3>
          <p class="text-2xl font-bold text-gray-800">{{ AppointmentCount }}</p>
        </div>
        <div class="text-3xl">📅</div>
      </div>

      <div
        class="bg-white p-6 rounded-xl shadow flex justify-between items-center hover:shadow-lg transition"
      >
        <div>
          <h3 class="text-gray-500 text-sm font-medium mb-1">Total Patients</h3>
          <p class="text-2xl font-bold text-gray-800">{{ totalPatientCount }}</p>
        </div>
        <div class="text-3xl">👥</div>
      </div>

      <div
        class="bg-white p-6 rounded-xl shadow flex justify-between items-center hover:shadow-lg transition"
      >
        <div>
          <h3 class="text-sm text-gray-500 font-medium mb-1">Pending Reviews</h3>
          <p class="text-2xl font-bold text-gray-800">{{ pendingReviewsCount }}</p>
        </div>
        <div class="text-3xl">📝</div>
      </div>

      <div
        class="bg-white p-6 rounded-xl shadow flex justify-between items-center hover:shadow-lg transition"
      >
        <div>
          <h3 class="text-gray-500 text-sm font-medium mb-1">Avg. Rating</h3>
          <p class="text-2xl font-bold text-gray-800">4.8 ⭐</p>
        </div>
        <div class="text-3xl">⭐</div>
      </div>
    </div>

    <!-- Today's Appointments Section -->
    <div class="bg-white p-6 rounded-xl shadow mb-6">
      <div class="flex justify-between items-center mb-4 border-b border-gray-200 pb-4">
        <h2 class="text-xl font-semibold text-gray-800">Today's Appointments</h2>
        <button
          (click)="viewAllAppointments()"
          class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-500 transition font-medium"
        >
          View All
        </button>
      </div>

      <!-- Loading State -->
      @if (isLoading) {
      <div class="text-center py-8">
        <div
          class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
        ></div>
        <p class="text-gray-600 mt-2">Loading appointments...</p>
      </div>
      }

      <!-- Appointments List -->
      @if (!isLoading && todayAppointments.length > 0) { @for (appointment of todayAppointments;
      track appointment.appointmentId) {
      <div
        class="bg-linear-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-600 p-5 rounded-lg mb-4 hover:shadow-md transition"
      >
        <div class="flex justify-between items-start mb-4">
          <div class="flex items-center gap-3">
            <div
              class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold"
            >
              {{ generateInitials(appointment.patient.name) }}
            </div>
            <div>
              <div class="font-semibold text-gray-800 text-lg">
                {{ appointment.patient.name }}
              </div>
              <div class="text-gray-600 text-sm mt-1 flex items-center gap-2">
                <span>🕐</span>
                <span>{{ appointment.startTime }} - {{ appointment.endTime }}</span>
              </div>
              @if (appointment.reason) {
              <div class="text-gray-500 text-sm mt-1">
                <strong>Reason:</strong> {{ appointment.reason }}
              </div>
              }
            </div>
          </div>

          <!-- Status Badge -->
          <span
            [ngClass]="{
              'bg-green-100 text-green-800': appointment.status === 'COMPLETED',
              'bg-blue-100 text-blue-800': appointment.status === 'CONFIRMED',
              'bg-yellow-100 text-yellow-800': appointment.status === 'PENDING',
              'bg-red-100 text-red-800': appointment.status === 'REJECTED'
            }"
            class="px-3 py-1 rounded-full text-sm font-semibold"
          >
            {{ appointment.status }}
          </span>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-2 mt-4">
          @if (appointment.status === 'CONFIRMED' || 'PENDING') {
          <button
            (click)="viewAppointmentDetails(appointment)"
            class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition font-medium"
          >
            👁️ View Details
          </button>

          } @if (appointment.status === 'PENDING') {
          <button
            (click)="confirmAppointment(appointment.appointmentId)"
            class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition font-medium"
          >
            ✅ Accept
          </button>
          <button
            (click)="rejectAppointment(appointment.appointmentId)"
            class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition font-medium"
          >
            ❌ Decline
          </button>
          }
        </div>
      </div>
      } }

      <!-- Empty State -->
      @if (!isLoading && todayAppointments.length === 0) {
      <div class="text-center py-12">
        <div class="text-6xl mb-4">📅</div>
        <p class="text-gray-500 text-lg font-medium">No appointments scheduled for today</p>
        <p class="text-gray-400 text-sm mt-2">Check back later or view all appointments</p>
      </div>
      }
    </div>
  </main>
</div>
